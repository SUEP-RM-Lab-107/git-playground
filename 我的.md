## 四、分支管理

### 理解分支

在 Git 中，**分支是轻量级的可变指针，指向某个提交对象**。默认主分支通常名为 `main`（旧项目可能为 `master`）。

分支的核心用途包括：

- 开发新功能时不影响主干代码
- 多个功能并行开发互不干扰
- 便于代码审查、测试和合并
- 实验性开发可随时丢弃而不影响主线

---

### 分支操作

#### 查看分支

```shell
# 查看本地所有分支（当前分支前有 * 标记）
git branch

# 查看所有分支（包括远程分支）
git branch -a

# 查看每个分支的最新提交摘要
git branch -v
```

#### 创建分支

```shell
# 仅创建新分支（不切换）
git branch develop

# 创建并立即切换到新分支
git checkout -b feature/user-login

# 创建并切换(新语法，推荐使用)
git switch -c feature/user-login
```

#### 切换分支

```shell
# 切换到已有分支
git checkout develop        # 传统方式
git switch develop          # 推荐方式

# 切换回主分支
git switch main
```

> 注意：切换分支前请确保工作区干净（无未提交修改），否则 Git 可能拒绝切换。

#### 合并分支

当功能开发完成，需将分支合并回主干（如 `main`）：

```shell
# 先切换到目标分支（通常是 main）
git switch main

# 将指定分支合并到当前分支
git merge develop
```

#### 删除分支
```
# 安全删除已合并的分支（推荐）
git branch -d develop

# 强制删除（即使未合并，慎用！）
git branch -D develop
```

> 优先使用 `-d`，避免意外丢失未合并的代码。

---

### 冲突解决

#### 冲突产生原因

当两个分支**修改了同一文件的同一区域**，Git 无法自动决定保留哪一方，就会产生冲突。

#### 识别冲突

执行 `git merge` 后若出现：

```
CONFLICT (content): Merge conflict in index.html
Automatic merge failed; fix conflicts and then commit the result.
```
同时，`git status` 会显示：
```
Unmerged paths:
  (use "git add <file>..." to mark resolution)
    both modified:   index.html
```
表示存在冲突，合并失败，需手动解决。

#### 解决冲突

打开冲突文件，你会看到类似标记：

```html
<<<<<<< HEAD
<div class="header">主分支的代码</div>
=======
<div class="header">特性分支的代码</div>
>>>>>>> feature/user-login
```

- `<<<<<<< HEAD` 到 `=======`：当前分支（如 `main`）的内容
- `=======` 到 `>>>>>>>`：要合并进来的分支内容

**操作步骤**：

1. 编辑文件，保留所需代码，**删除所有冲突标记**（`<<<<<<<`, `=======`, `>>>>>>>`）
2. 解决冲突

```shell
# 添加已解决的文件到暂存区
git add index.html

# 或添加所有已解决的文件
git add .
```

3. 完成合并提交：

```shell
# 现代 Git 会自动生成标准的合并提交信息
git commit -m "解决合并冲突"
```

## **避免冲突的技巧**
为了减少冲突的发生，建议：团队成员之间及时沟通，避免多人同时修改同一文件；合理划分模块，让每个成员负责不同的文件或功能；频繁合并主分支的更新到自己的分支。

---

## 五、远程仓库

### 认识远程仓库

远程仓库托管于网络平台（如 GitHub、GitLab、Gitee），用于团队协作和代码备份。

- 默认远程仓库名通常为 `origin`（仅为约定，可自定义）
- 一个本地仓库可关联多个远程仓库

### 关联远程仓库

**添加远程仓库**

如果你的本地仓库还没有关联远程仓库，可以使用以下命令添加：

```bash
git remote add origin https://github.com/用户名/仓库名.git
```

**查看远程仓库**

```bash
# 查看已关联的远程仓库
git remote -v

# 查看远程仓库的详细信息
git remote show origin
```

### 推送与拉取

##### 推送到远程

将本地分支的提交推送到远程仓库：

```bash
# 首次推送并关联分支
git push -u origin main

# 后续推送
git push

# 推送本地分支到远程仓库（如果远程不存在）
git push origin feature-branch
```

**拉取远程更新**

从远程仓库获取最新的更新并合并到本地：

```bash
# 拉取并合并远程更新
git pull

# 只获取远程更新，不合并
git fetch

# 拉取特定分支
git pull origin feature-branch
```

**fetch 与 pull 的区别**

`git fetch`
只获取远程仓库的更新到本地，但不会自动合并或修改你的工作目录。`git pull` 相当于
`git fetch` 加 `git merge`，会自动将远程更新合并到当前分支。推荐在合并前先使用
`git fetch` 查看有哪些更新，然后再决定是否合并。

### SSH 密钥配置

使用 SSH 协议连接远程仓库可以避免每次操作都输入密码。

**生成 SSH 密钥**

```bash
# 生成 SSH 密钥（邮箱使用你的邮箱地址）
ssh-keygen -t ed25519 -C "你的邮箱@example.com"
# Ed25519 比ssh-keygen -t rsa更安全
```

敲击三次回车键接受默认保存位置，可以选择设置密码（passphrase）来保护密钥。
执行`ls ~/.ssh/` 应该会有`id_ed25519.pub`(公钥)和`id_ed25519`(私钥)两个文件。

**配置远程仓库使用 SSH**

复制公钥内容（`~/.ssh/id_ed25519.pub`）到 GitHub/GitLab 的 SSH Keys
设置中。之后克隆或添加远程仓库时使用 SSH 地址：

```bash
git clone git@github.com:用户名/仓库名.git
```

---
## 六、撤销操作

### 撤销工作区修改

如果修改了文件但还没有添加到暂存区，可以使用以下命令撤销：

```bash
# 撤销单个文件的修改
git checkout -- 文件名

# 撤销所有文件的修改
git checkout -- .
```

注意：这条命令会丢失所有未提交的修改，请谨慎使用。

### 撤销暂存区操作

如果错误地将文件添加到了暂存区，可以使用以下命令撤销：

```bash
# 将文件从暂存区移回工作区
git reset HEAD 文件名

# 将所有文件从暂存区移回工作区
git reset HEAD .
```

### 回退版本

如果需要回退到之前的某个提交，可以使用 reset 命令：

```bash
# 回退一个版本（保留修改在工作区）
git reset --soft HEAD~1

# 回退一个版本（保留修改在工作区，文件状态为已修改）
git reset HEAD~1

# 回退一个版本（丢弃所有修改）
git reset --hard HEAD~1

# 回退到指定提交
git reset --hard 提交哈希值
```

使用 `--hard`
参数时要特别小心，它会丢失所有未提交的修改且无法恢复。如果只是想查看历史提交但不想修改，可以使用
`git checkout` 创建一个「分离头指针」状态。

### 反转提交

如果想撤销某次提交但保留历史记录（推荐用于已推送到远程的提交），可以使用
`git revert`：

```bash
# 反转最近一次提交
git revert HEAD

# 反转指定提交
git revert 提交哈希值
```

revert
会创建一个新的提交来撤销指定提交的修改，这样在团队协作中更安全，不会影响其他人的工作。

---

## 七、常用命令速查表

### 基础操作

|命令|说明|
|---|---|
|`git init`|初始化新仓库|
|`git clone <url>`|克隆远程仓库|
|`git add <file>`|添加文件到暂存区|
|`git commit -m "msg"`|提交暂存区更改|
|`git status`|查看当前状态|
|`git log`|查看提交历史|

### 分支管理

| 命令                     | 说明       |
| ---------------------- | -------- |
| `git branch`           | 列出本地分支   |
| `git branch <name>`    | 创建分支     |
| `git switch <name>`    | 切换分支（推荐） |
| `git switch -c <name>` | 创建并切换    |
| `git merge <branch>`   | 合并分支     |
| `git branch -d <name>` | 删除已合并分支  |

### 远程操作

| 命令                            | 说明      |
| ----------------------------- | ------- |
| `git remote add origin <url>` | 关联远程仓库  |
| `git remote -v`               | 查看远程地址  |
| `git push -u origin main`     | 首次推送并跟踪 |
| `git pull`                    | 拉取并合并   |
| `git fetch`                   | 仅获取更新   |

### 查看与撤销

|命令|说明|
|---|---|
|`git diff`|工作区 vs 暂存区|
|`git diff HEAD`|工作区 vs 最新提交|
|`git restore --staged <file>`|撤销暂存|
|`git checkout -- <file>`|撤销工作区修改|
|`git reset --hard <commit>`|强制回退版本|
|`git revert <commit>`|安全反转提交|
